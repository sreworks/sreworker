<div align="center">

# AI Code Worker Manager

**é€šç”¨çš„ AI Code CLI è¿›ç¨‹ç®¡ç†å’Œäº¤äº’ç³»ç»Ÿ**

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![Python](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.109.0-009688.svg)](https://fastapi.tiangolo.com)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)

é€šè¿‡ç®€æ´çš„ Web ç•Œé¢ç®¡ç†å¤šä¸ª AI Code CLI Worker å®ä¾‹ï¼ˆæ”¯æŒ Claude Codeã€OpenCode ç­‰ï¼‰ï¼Œå®æ—¶æŸ¥çœ‹è¾“å‡ºå’Œäº¤äº’ã€‚æ”¯æŒå¤šè¿›ç¨‹éš”ç¦»ã€å®æ—¶é€šä¿¡å’Œå®Œæ•´çš„æ—¥å¿—è¿½è¸ªã€‚

[åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) â€¢ [æ”¯æŒçš„ AI CLI](#æ”¯æŒçš„-ai-cli) â€¢ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„) â€¢ [API æ–‡æ¡£](#api-æ–‡æ¡£) â€¢ [è´¡çŒ®æŒ‡å—](#è´¡çŒ®æŒ‡å—)

</div>

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | æè¿° |
|------|------|
| ğŸ¤– **å¤š AI CLI æ”¯æŒ** | æ”¯æŒå¤šç§ AI Code CLIï¼ˆClaude Codeã€OpenCode ç­‰ï¼‰ï¼Œç»Ÿä¸€ç®¡ç†ç•Œé¢ |
| ğŸš€ **å¤š Worker ç®¡ç†** | åœ¨ Web ç•Œé¢ä¸Šåˆ›å»ºã€ç®¡ç†å¤šä¸ªç‹¬ç«‹çš„ AI Code è¿›ç¨‹ |
| ğŸ’¬ **å®æ—¶äº¤äº’** | é€šè¿‡ WebSocket å®æ—¶å‘é€å‘½ä»¤å¹¶æ¥æ”¶å“åº” |
| ğŸ“Š **è¾“å‡ºç›‘æ§** | å®æ—¶ç›‘å¬æ—¥å¿—æ–‡ä»¶ï¼Œè§£æå¹¶å±•ç¤º AI Code CLI çš„æ‰€æœ‰è¾“å‡º |
| ğŸ¯ **è¿›ç¨‹éš”ç¦»** | æ¯ä¸ª Worker è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼Œäº’ä¸å¹²æ‰° |
| ğŸ“ **æ—¥å¿—è¿½è¸ª** | å®Œæ•´è®°å½•æ¯ä¸ª Worker çš„äº¤äº’å†å²å’ŒçŠ¶æ€å˜åŒ– |
| ğŸ”Œ **RESTful API** | æä¾›å®Œæ•´çš„ REST API ç”¨äºé›†æˆå’Œè‡ªåŠ¨åŒ– |
| ğŸŒ **Web ç•Œé¢** | ç®€æ´ç›´è§‚çš„ Web UIï¼Œæ— éœ€å®‰è£…å®¢æˆ·ç«¯ |
| ğŸ”§ **æ’ä»¶åŒ–æ¶æ„** | æ˜“äºæ‰©å±•ï¼Œæ”¯æŒæ·»åŠ æ–°çš„ AI Code CLI |

## ğŸ¤– æ”¯æŒçš„ AI CLI

æœ¬ç³»ç»Ÿé‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œæ”¯æŒå¤šç§ AI Code CLI å·¥å…·ï¼š

| AI CLI | çŠ¶æ€ | è¾“å‡ºæ–¹å¼ | æ—¥å¿—æ ¼å¼ | è¯´æ˜ |
|--------|------|----------|----------|------|
| **Claude Code** | âœ… å·²æ”¯æŒ | æ–‡ä»¶ç›‘å¬ | JSONL | è¾“å‡ºåˆ° project.jsonlï¼Œéœ€è¦æ–‡ä»¶ç›‘å¬å™¨ |
| **OpenCode** | âœ… å·²æ”¯æŒ | stdout | JSON | ç›´æ¥è¾“å‡ºåˆ° stdoutï¼Œå®æ—¶è¯»å– |
| **Cursor** | ğŸš§ è®¡åˆ’ä¸­ | - | - | AI-first ä»£ç ç¼–è¾‘å™¨ CLI |
| **Aider** | ğŸš§ è®¡åˆ’ä¸­ | - | - | AI pair programming in terminal |
| **è‡ªå®šä¹‰ CLI** | ğŸ’¡ å¯æ‰©å±• | å¯é…ç½® | å¯é…ç½® | é€šè¿‡é€‚é…å™¨æ¥å£æ”¯æŒä»»æ„è¾“å‡ºæ–¹å¼ |

### å¦‚ä½•æ·»åŠ æ–°çš„ AI CLI æ”¯æŒ

ç³»ç»Ÿæä¾›äº†ç»Ÿä¸€çš„ `BaseWorkerAdapter` æ¥å£ï¼Œä½ å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„ AI CLI æ”¯æŒã€‚æ ¹æ® AI CLI çš„è¾“å‡ºæ–¹å¼ï¼Œæœ‰ä¸¤ç§å®ç°æ¨¡å¼ï¼š

#### æ¨¡å¼ 1: æ–‡ä»¶ç›‘å¬æ–¹å¼
é€‚ç”¨äºè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶çš„ AI CLIï¼ˆå¦‚ Claude Code çš„ project.jsonlï¼‰
- å®ç° `needs_file_watcher()` è¿”å› `True`
- å®ç° `get_log_file_path()` è¿”å›æ—¥å¿—æ–‡ä»¶è·¯å¾„
- å®ç° `get_output_stream()` ä»æ–‡ä»¶è¯»å–å¹¶è§£æè¾“å‡º

#### æ¨¡å¼ 2: stdout ç›´æ¥è¯»å–æ–¹å¼
é€‚ç”¨äºç›´æ¥è¾“å‡ºåˆ° stdout çš„ AI CLIï¼ˆå¦‚ OpenCodeï¼‰
- å®ç° `needs_file_watcher()` è¿”å› `False`
- å®ç° `get_log_file_path()` è¿”å› `None`
- å®ç° `get_output_stream()` ä»è¿›ç¨‹ stdout è¯»å–è¾“å‡º

è¯¦ç»†çš„é€‚é…å™¨å¼€å‘æ–‡æ¡£è¯·å‚è§ [docs/adapter-development.md](./docs/adapter-development.md)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.9+
- è‡³å°‘ä¸€ä¸ª AI Code CLIï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ï¼‰ï¼š
  - [Claude Code](https://github.com/anthropics/claude-code) - Anthropic å®˜æ–¹å·¥å…·
  - [OpenCode](https://github.com/opencode/opencode) - å¼€æºæ›¿ä»£æ–¹æ¡ˆ
  - æˆ–å…¶ä»–å…¼å®¹çš„ AI CLI
- Git

### ä¸‰æ­¥å¿«é€Ÿå¯åŠ¨

```bash
# 1. å…‹éš†å¹¶å®‰è£…
git clone <repository-url>
cd pyworker
pip install -r requirements.txt

# 2. é…ç½®ç¯å¢ƒï¼ˆä¸¤ç§æ–¹å¼ä»»é€‰å…¶ä¸€ï¼‰

# æ–¹å¼ 1: ä½¿ç”¨ .env æ–‡ä»¶
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½® CLAUDE_API_KEY æˆ– OPENCODE_API_KEY

# æ–¹å¼ 2: ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡
export ANTHROPIC_API_KEY=your-key-here  # ç”¨äº Claude Code
# æˆ–
export OPENCODE_API_KEY=your-key-here   # ç”¨äº OpenCode

# 3. å¯åŠ¨æœåŠ¡
uvicorn app.main:app --host 0.0.0.0 --port 7788
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ [http://localhost:7788](http://localhost:7788) å³å¯å¼€å§‹ä½¿ç”¨ï¼

**æ³¨æ„**: ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå˜é‡ï¼Œä¼˜å…ˆä½¿ç”¨ `.env` æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚

### é…ç½®ç¤ºä¾‹

#### ä½¿ç”¨ Claude Code

```env
# .env æ–‡ä»¶
DEFAULT_AI_CLI=claude
CLAUDE_BINARY=claude
CLAUDE_API_KEY=your-anthropic-api-key
```

#### ä½¿ç”¨ OpenCode

```env
# .env æ–‡ä»¶
DEFAULT_AI_CLI=opencode
OPENCODE_BINARY=opencode
OPENCODE_API_KEY=your-opencode-api-key
OPENCODE_API_BASE=https://api.opencode.com
```

#### åŒæ—¶æ”¯æŒå¤šä¸ª AI CLI

```env
# .env æ–‡ä»¶
ENABLED_AI_CLIS=claude,opencode

# Claude Code é…ç½®
CLAUDE_BINARY=claude
CLAUDE_API_KEY=your-anthropic-api-key

# OpenCode é…ç½®
OPENCODE_BINARY=opencode
OPENCODE_API_KEY=your-opencode-api-key
```

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç”¨é€” | ç‰ˆæœ¬ |
|------|------|------|
| **FastAPI** | ç°ä»£åŒ–çš„ Python Web æ¡†æ¶ï¼Œæ”¯æŒå¼‚æ­¥å’Œ WebSocket | 0.109.0 |
| **asyncio** | å¼‚æ­¥å¤„ç† Claude Code è¿›ç¨‹å’Œæ–‡ä»¶ç›‘å¬ | å†…ç½® |
| **Watchdog** | ç›‘å¬ project.jsonl æ–‡ä»¶å˜åŒ– | 4.0.0 |
| **Pydantic** | æ•°æ®éªŒè¯å’Œåºåˆ—åŒ– | 2.5.3 |
| **WebSockets** | WebSocket é€šä¿¡æ”¯æŒ | 12.0 |

### å‰ç«¯æŠ€æœ¯æ ˆ

- **HTML5 + JavaScript**: ç®€æ´çš„çº¯å‰ç«¯å®ç°ï¼Œæ— éœ€æ„å»ºå·¥å…·
- **WebSocket API**: å®æ—¶åŒå‘é€šä¿¡
- **Fetch API**: RESTful API è°ƒç”¨

### ç³»ç»Ÿæ¶æ„

#### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Web Browser                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Worker List  â”‚  â”‚ Chat Interfaceâ”‚ â”‚ Output Panel â”‚      â”‚
â”‚  â”‚  + AI Type   â”‚  â”‚               â”‚ â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚                    â”‚
           â”‚ HTTP REST         â”‚ WebSocket          â”‚
           â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FastAPI Server                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Worker Manager                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Worker 1    â”‚  â”‚  Worker 2    â”‚  â”‚  Worker N  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  (Claude)    â”‚  â”‚  (OpenCode)  â”‚  â”‚  (Custom)  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ Adapter  â”‚ â”‚  â”‚ â”‚ Adapter  â”‚ â”‚  â”‚ â”‚Adapter â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”‚ (Claude) â”‚ â”‚  â”‚ â”‚(OpenCode)â”‚ â”‚  â”‚ â”‚(Custom)â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚      â†“       â”‚  â”‚      â†“       â”‚  â”‚     â†“     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”‚Process   â”‚ â”‚  â”‚ â”‚Process   â”‚ â”‚  â”‚ â”‚Process â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”‚Handler   â”‚ â”‚  â”‚ â”‚Handler   â”‚ â”‚  â”‚ â”‚Handler â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚      â†“       â”‚  â”‚      â†“       â”‚  â”‚     â†“     â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”‚File      â”‚ â”‚  â”‚ â”‚File      â”‚ â”‚  â”‚ â”‚File    â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â”‚Watcher   â”‚ â”‚  â”‚ â”‚Watcher   â”‚ â”‚  â”‚ â”‚Watcher â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚                    â”‚
           â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AI Code CLI Processes (å¤šç§ç±»å‹)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   claude     â”‚  â”‚  opencode    â”‚  â”‚  custom-ai   â”‚      â”‚
â”‚  â”‚   --project  â”‚  â”‚  --workspace â”‚  â”‚  --dir       â”‚      â”‚
â”‚  â”‚   dir1       â”‚  â”‚  dir2        â”‚  â”‚  dirN        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚                    â”‚
           â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ—¥å¿—æ–‡ä»¶ (ç»Ÿä¸€çš„ JSONL æ ¼å¼)                     â”‚
â”‚  project.jsonl    opencode.jsonl    custom.jsonl            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é€‚é…å™¨æ¨¡å¼è®¾è®¡

ç³»ç»Ÿé‡‡ç”¨é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰ï¼Œå°†ä¸åŒ AI CLI çš„å·®å¼‚æŠ½è±¡åŒ–ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BaseWorkerAdapter (æŠ½è±¡åŸºç±»)            â”‚
â”‚  - get_command(): List[str]                          â”‚
â”‚  - parse_output(line: str): Dict                     â”‚
â”‚  - format_input(message: str): str                   â”‚
â”‚  - get_log_file_path(): str                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–²
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚            â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ClaudeAdapter   â”‚  â”‚OpenCodeAdaptâ”‚  â”‚  CustomAdapter     â”‚
â”‚                 â”‚  â”‚er           â”‚  â”‚                    â”‚
â”‚ â€¢ claude        â”‚  â”‚â€¢ opencode   â”‚  â”‚ â€¢ custom-ai        â”‚
â”‚ â€¢ project.jsonl â”‚  â”‚â€¢ opencode   â”‚  â”‚ â€¢ custom.jsonl     â”‚
â”‚                 â”‚  â”‚  .jsonl     â”‚  â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

æœ¬é¡¹ç›®æä¾›ä¸¤ç§è¯­è¨€å®ç°ï¼ŒåŠŸèƒ½å®Œå…¨ä¸€è‡´ï¼š

```
ai-code-worker-manager/
â”œâ”€â”€ README.md                    # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ LICENSE                      # Apache 2.0 è®¸å¯è¯
â”œâ”€â”€ docs/                        # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ adapter-development.md   # é€‚é…å™¨å¼€å‘æŒ‡å—
â”‚   â”œâ”€â”€ api-reference.md         # API å‚è€ƒæ–‡æ¡£
â”‚   â””â”€â”€ deployment.md            # éƒ¨ç½²æŒ‡å—
â”‚
â”œâ”€â”€ pyworker/                   # ğŸ Python å®ç° (FastAPI)
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py            # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ adapters/            # ğŸ”Œ AI CLI é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py          # åŸºç¡€é€‚é…å™¨æŠ½è±¡ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ claude.py        # Claude Code é€‚é…å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ opencode.py      # OpenCode é€‚é…å™¨
â”‚   â”‚   â”‚   â””â”€â”€ registry.py      # é€‚é…å™¨æ³¨å†Œè¡¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ worker.py
â”‚   â”‚   â”‚   â”œâ”€â”€ message.py
â”‚   â”‚   â”‚   â””â”€â”€ ai_cli.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ worker_manager.py
â”‚   â”‚   â”‚   â”œâ”€â”€ process_handler.py
â”‚   â”‚   â”‚   â””â”€â”€ file_watcher.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ api/                 # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ workers.py
â”‚   â”‚   â”‚   â””â”€â”€ websocket.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ jsonl_parser.py
â”‚   â”‚       â””â”€â”€ logger.py
â”‚   â”‚
â”‚   â”œâ”€â”€ static/                  # é™æ€æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ js/
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                    # æ•°æ®ç›®å½•
â”‚   â”‚   â””â”€â”€ workers/
â”‚   â”‚
â”‚   â””â”€â”€ tests/                   # æµ‹è¯•
â”‚       â”œâ”€â”€ test_adapters/
â”‚       â”œâ”€â”€ test_worker_manager.py
â”‚       â””â”€â”€ test_process_handler.py
â”‚
â””â”€â”€ js-worker/                   # ğŸŸ¨ JavaScript/TypeScript å®ç° (Node.js)
    â”œâ”€â”€ README.md
    â”œâ”€â”€ package.json
    â”œâ”€â”€ tsconfig.json
    â”œâ”€â”€ .env.example
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ index.ts             # åº”ç”¨å…¥å£
    â”‚   â”œâ”€â”€ config.ts            # é…ç½®ç®¡ç†
    â”‚   â”‚
    â”‚   â”œâ”€â”€ adapters/            # ğŸ”Œ AI CLI é€‚é…å™¨
    â”‚   â”‚   â”œâ”€â”€ base.ts          # åŸºç¡€é€‚é…å™¨æŠ½è±¡ç±»
    â”‚   â”‚   â”œâ”€â”€ claude.ts        # Claude Code é€‚é…å™¨
    â”‚   â”‚   â”œâ”€â”€ opencode.ts      # OpenCode é€‚é…å™¨
    â”‚   â”‚   â””â”€â”€ registry.ts      # é€‚é…å™¨æ³¨å†Œè¡¨
    â”‚   â”‚
    â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
    â”‚   â”‚   â”œâ”€â”€ worker.ts
    â”‚   â”‚   â”œâ”€â”€ message.ts
    â”‚   â”‚   â””â”€â”€ aiCli.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
    â”‚   â”‚   â”œâ”€â”€ workerManager.ts
    â”‚   â”‚   â”œâ”€â”€ processHandler.ts
    â”‚   â”‚   â””â”€â”€ fileWatcher.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ api/                 # API è·¯ç”±
    â”‚   â”‚   â”œâ”€â”€ workers.ts
    â”‚   â”‚   â””â”€â”€ websocket.ts
    â”‚   â”‚
    â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
    â”‚       â”œâ”€â”€ jsonlParser.ts
    â”‚       â””â”€â”€ logger.ts
    â”‚
    â”œâ”€â”€ public/                  # é™æ€æ–‡ä»¶
    â”‚   â”œâ”€â”€ index.html
    â”‚   â”œâ”€â”€ css/
    â”‚   â””â”€â”€ js/
    â”‚
    â”œâ”€â”€ data/                    # æ•°æ®ç›®å½•
    â”‚   â””â”€â”€ workers/
    â”‚
    â””â”€â”€ tests/                   # æµ‹è¯•
        â”œâ”€â”€ adapters/
        â”œâ”€â”€ workerManager.test.ts
        â””â”€â”€ processHandler.test.ts
```

## ğŸ¯ é€‰æ‹©å“ªä¸ªå®ç°ï¼Ÿ

### Python å®ç° (pyworker)

**æ¨èåœºæ™¯ï¼š**
- éœ€è¦å¿«é€Ÿéƒ¨ç½²å’Œå¼€å‘
- å›¢é˜Ÿç†Ÿæ‚‰ Python ç”Ÿæ€
- éœ€è¦ä¸ Python æ•°æ®ç§‘å­¦å·¥å…·é›†æˆ

**æŠ€æœ¯æ ˆï¼š**
- FastAPI - é«˜æ€§èƒ½ Web æ¡†æ¶
- asyncio - å¼‚æ­¥ I/O
- Watchdog - æ–‡ä»¶ç›‘å¬
- Pydantic - æ•°æ®éªŒè¯

**å¯åŠ¨æ–¹å¼ï¼š**
```bash
cd pyworker
pip install -r requirements.txt
uvicorn app.main:app --host 0.0.0.0 --port 7788
```

### JavaScript/TypeScript å®ç° (js-worker)

**æ¨èåœºæ™¯ï¼š**
- å…¨æ ˆ JavaScript å¼€å‘å›¢é˜Ÿ
- éœ€è¦æ›´å¥½çš„å‰ç«¯é›†æˆ
- å¸Œæœ›ä½¿ç”¨ npm ç”Ÿæ€ç³»ç»Ÿ

**æŠ€æœ¯æ ˆï¼š**
- Express/Fastify - Web æ¡†æ¶
- TypeScript - ç±»å‹å®‰å…¨
- ws - WebSocket åº“
- chokidar - æ–‡ä»¶ç›‘å¬

**å¯åŠ¨æ–¹å¼ï¼š**
```bash
cd js-worker
npm install
npm run build
npm start
```

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | Python å®ç° | JavaScript å®ç° |
|------|------------|----------------|
| å¤š AI CLI æ”¯æŒ | âœ… | âœ… |
| æ–‡ä»¶ç›‘å¬ | âœ… Watchdog | âœ… chokidar |
| stdout è¯»å– | âœ… asyncio | âœ… streams |
| WebSocket | âœ… FastAPI WebSocket | âœ… ws |
| ç±»å‹å®‰å…¨ | âœ… Pydantic | âœ… TypeScript |
| æ€§èƒ½ | ğŸš€ é«˜ | ğŸš€ é«˜ |
| å†…å­˜å ç”¨ | é€‚ä¸­ | è¾ƒä½ |
| éƒ¨ç½²éš¾åº¦ | ç®€å• | ç®€å• |

## ğŸ’¿ å®‰è£…æŒ‡å—

### å‰ç½®è¦æ±‚

**é€šç”¨è¦æ±‚ï¼š**
- Git
- è‡³å°‘ä¸€ä¸ª AI Code CLIï¼ˆClaude Codeã€OpenCode ç­‰ï¼‰

**Python å®ç° (pyworker)ï¼š**
- Python 3.9+

**JavaScript å®ç° (js-worker)ï¼š**
- Node.js 18+
- npm æˆ– yarn

---

### ğŸ Python å®ç°å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®å¹¶è¿›å…¥ç›®å½•**
```bash
git clone <repository-url>
cd ai-code-worker-manager/pyworker
```

2. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows
```

3. **å®‰è£…ä¾èµ–**
```bash
pip install -r requirements.txt
```

4. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½® AI CLI
```

5. **å¯åŠ¨æœåŠ¡**
```bash
uvicorn app.main:app --host 0.0.0.0 --port 7788 --reload
```

6. **è®¿é—®åº”ç”¨**
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:7788

#### Python ä¾èµ– (requirements.txt)

```txt
fastapi==0.109.0
uvicorn[standard]==0.27.0
websockets==12.0
watchdog==4.0.0
pydantic==2.5.3
pydantic-settings==2.1.0
python-dotenv==1.0.0
aiofiles==23.2.1
```

---

### ğŸŸ¨ JavaScript å®ç°å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®å¹¶è¿›å…¥ç›®å½•**
```bash
git clone <repository-url>
cd ai-code-worker-manager/js-worker
```

2. **å®‰è£…ä¾èµ–**
```bash
npm install
# æˆ–ä½¿ç”¨ yarn
yarn install
```

3. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½® AI CLI
```

4. **æ„å»ºé¡¹ç›®**
```bash
npm run build
```

5. **å¯åŠ¨æœåŠ¡**
```bash
npm start
# æˆ–å¼€å‘æ¨¡å¼ï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
npm run dev
```

6. **è®¿é—®åº”ç”¨**
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:7788

#### JavaScript ä¾èµ– (package.json)

```json
{
  "dependencies": {
    "express": "^4.18.0",
    "ws": "^8.16.0",
    "chokidar": "^3.5.3",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "@types/express": "^4.17.21",
    "@types/ws": "^8.5.10",
    "typescript": "^5.3.0",
    "tsx": "^4.7.0"
  }
}
```

### .env.example

```env
# ========================================
# Server Configuration
# ========================================
HOST=0.0.0.0
PORT=7788
DEBUG=true

# ========================================
# AI CLI Configuration
# ========================================
# é»˜è®¤ä½¿ç”¨çš„ AI CLI (claude, opencode, custom)
DEFAULT_AI_CLI=claude

# å¯ç”¨çš„ AI CLI åˆ—è¡¨ (é€—å·åˆ†éš”)
ENABLED_AI_CLIS=claude,opencode

# ========================================
# Claude Code Configuration
# ========================================
CLAUDE_BINARY=claude
CLAUDE_API_KEY=your-anthropic-api-key-here
CLAUDE_MODEL=claude-3-5-sonnet-20241022  # å¯é€‰ï¼šæŒ‡å®šæ¨¡å‹

# ========================================
# OpenCode Configuration
# ========================================
OPENCODE_BINARY=opencode
OPENCODE_API_KEY=your-opencode-api-key-here
OPENCODE_API_BASE=https://api.opencode.com  # å¯é€‰ï¼šè‡ªå®šä¹‰ API åœ°å€
OPENCODE_MODEL=gpt-4  # å¯é€‰ï¼šæŒ‡å®šæ¨¡å‹

# ========================================
# Worker Configuration
# ========================================
WORKERS_BASE_DIR=./data/workers
MAX_WORKERS=10
WORKER_TIMEOUT=300  # Worker è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰

# ========================================
# Logging
# ========================================
LOG_LEVEL=INFO
LOG_FILE=./logs/app.log
```

## ğŸ“– ä½¿ç”¨è¯´æ˜

### åŸºæœ¬æ“ä½œ

æ— è®ºä½¿ç”¨ Python è¿˜æ˜¯ JavaScript å®ç°ï¼ŒWeb ç•Œé¢æ“ä½œå®Œå…¨ç›¸åŒï¼š

#### 1. åˆ›å»º Worker

- ç‚¹å‡» **"New Worker"** æŒ‰é’®
- å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
  - **Worker åç§°**ï¼šè‡ªå®šä¹‰åç§°
  - **é¡¹ç›®è·¯å¾„**ï¼šè¦å·¥ä½œçš„é¡¹ç›®ç›®å½•
  - **AI CLI ç±»å‹**ï¼šé€‰æ‹© claudeã€opencode æˆ–å…¶ä»–å·²é…ç½®çš„ AI CLI
  - **é…ç½®é€‰é¡¹**ï¼ˆå¯é€‰ï¼‰ï¼šæ¨¡å‹ã€æ¸©åº¦ç­‰å‚æ•°
- ç‚¹å‡»åˆ›å»ºï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¯åŠ¨å¯¹åº”çš„ AI CLI è¿›ç¨‹

#### 2. å‘é€å‘½ä»¤

- åœ¨ Worker åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ª Worker
- åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å‘½ä»¤æˆ–é—®é¢˜
- æŒ‰ `Enter` æˆ–ç‚¹å‡»å‘é€æŒ‰é’®
- ç³»ç»Ÿä¼šå°†æ¶ˆæ¯å‘é€ç»™å¯¹åº”çš„ AI CLI

#### 3. æŸ¥çœ‹è¾“å‡º

- å®æ—¶æ˜¾ç¤º AI CLI çš„å“åº”
- åŒ…æ‹¬æ–‡æœ¬è¾“å‡ºã€å·¥å…·è°ƒç”¨ã€é”™è¯¯ä¿¡æ¯ç­‰
- æ”¯æŒè¯­æ³•é«˜äº®å’Œä»£ç å—æ¸²æŸ“
- è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯

#### 4. ç®¡ç† Worker

- **æš‚åœ/æ¢å¤**ï¼šä¸´æ—¶æš‚åœ Worker çš„æ‰§è¡Œ
- **é‡å¯**ï¼šé‡æ–°å¯åŠ¨ Worker è¿›ç¨‹
- **åˆ é™¤**ï¼šåœæ­¢å¹¶åˆ é™¤ Worker
- **æŸ¥çœ‹è¯¦æƒ…**ï¼šæŸ¥çœ‹ Worker çš„é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯

### ä½¿ç”¨ç¤ºä¾‹

```bash
# ç¤ºä¾‹ 1: è®© AI åˆ›å»ºä¸€ä¸ªæ–°åŠŸèƒ½
"å¸®æˆ‘åˆ›å»ºä¸€ä¸ªç”¨æˆ·è®¤è¯æ¨¡å—ï¼ŒåŒ…å«ç™»å½•ã€æ³¨å†Œå’Œå¯†ç é‡ç½®åŠŸèƒ½"

# ç¤ºä¾‹ 2: ä»£ç å®¡æŸ¥
"è¯·å®¡æŸ¥ src/auth.py æ–‡ä»¶ï¼Œæ‰¾å‡ºæ½œåœ¨çš„å®‰å…¨é—®é¢˜"

# ç¤ºä¾‹ 3: é‡æ„ä»£ç 
"é‡æ„ utils/helper.py ä¸­çš„ä»£ç ï¼Œæé«˜å¯è¯»æ€§å’Œæ€§èƒ½"

# ç¤ºä¾‹ 4: ä¿®å¤ Bug
"ä¿®å¤æµ‹è¯•ä¸­æŠ¥å‘Šçš„ 'IndexError: list index out of range' é”™è¯¯"
```

## API æ–‡æ¡£

### REST API

#### è·å–æ‰€æœ‰ Workers
```http
GET /api/workers
Response: {
  "workers": [
    {
      "id": "uuid",
      "name": "worker-1",
      "project_path": "/path/to/project",
      "status": "running",
      "created_at": "2024-01-01T00:00:00Z",
      "last_activity": "2024-01-01T00:00:00Z"
    }
  ]
}
```

#### åˆ›å»º Worker
```http
POST /api/workers
Body: {
  "name": "worker-1",
  "project_path": "/path/to/project",
  "ai_cli_type": "claude",  // å¯é€‰: claude, opencode, æˆ–å…¶ä»–å·²æ³¨å†Œçš„ AI CLI
  "config": {                // å¯é€‰: AI CLI ç‰¹å®šé…ç½®
    "model": "claude-3-5-sonnet-20241022",
    "temperature": 0.7
  }
}
Response: {
  "id": "uuid",
  "name": "worker-1",
  "ai_cli_type": "claude",
  "status": "created",
  "created_at": "2024-01-01T00:00:00Z"
}
```

#### è·å– Worker è¯¦æƒ…
```http
GET /api/workers/{worker_id}
Response: {
  "id": "uuid",
  "name": "worker-1",
  "project_path": "/path/to/project",
  "ai_cli_type": "claude",
  "status": "running",
  "created_at": "2024-01-01T00:00:00Z",
  "last_activity": "2024-01-01T00:00:00Z",
  "messages": [...]
}
```

#### è·å–å¯ç”¨çš„ AI CLI åˆ—è¡¨
```http
GET /api/ai-clis
Response: {
  "available_clis": [
    {
      "type": "claude",
      "name": "Claude Code",
      "version": "0.1.0",
      "enabled": true,
      "description": "Anthropic å®˜æ–¹ AI ç¼–ç¨‹åŠ©æ‰‹"
    },
    {
      "type": "opencode",
      "name": "OpenCode",
      "version": "1.0.0",
      "enabled": true,
      "description": "å¼€æº AI ç¼–ç¨‹å·¥å…·"
    }
  ],
  "default": "claude"
}
```

#### åˆ é™¤ Worker
```http
DELETE /api/workers/{worker_id}
Response: {
  "status": "deleted",
  "message": "Worker deleted successfully"
}
```

### WebSocket API

#### è¿æ¥ Worker
```javascript
ws://localhost:7788/ws/{worker_id}
```

#### å‘é€æ¶ˆæ¯
```json
{
  "type": "message",
  "content": "ä½ å¥½ï¼Œå¸®æˆ‘åˆ›å»ºä¸€ä¸ª Python é¡¹ç›®"
}
```

#### æ¥æ”¶æ¶ˆæ¯
```json
{
  "type": "output",
  "timestamp": "2024-01-01T00:00:00Z",
  "content": {
    "role": "assistant",
    "text": "å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ åˆ›å»ºä¸€ä¸ª Python é¡¹ç›®...",
    "tool_calls": [...]
  }
}
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. Adapterï¼ˆé€‚é…å™¨ï¼‰
- **BaseWorkerAdapter**: æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€æ¥å£
- **ClaudeAdapter**: Claude Code é€‚é…å™¨ï¼Œä½¿ç”¨æ–‡ä»¶ç›‘å¬æ–¹å¼
- **OpenCodeAdapter**: OpenCode é€‚é…å™¨ï¼Œä½¿ç”¨ stdout è¯»å–æ–¹å¼
- **AdapterRegistry**: é€‚é…å™¨æ³¨å†Œè¡¨ï¼Œç®¡ç†æ‰€æœ‰å¯ç”¨é€‚é…å™¨

### 2. Process Handlerï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
- å¯åŠ¨å’Œç®¡ç† AI CLI è¿›ç¨‹
- æ ¹æ®é€‚é…å™¨ç±»å‹é€‰æ‹©è¾“å‡ºè¯»å–æ–¹å¼
- å¤„ç†è¿›ç¨‹çš„è¾“å…¥è¾“å‡ºå’Œç”Ÿå‘½å‘¨æœŸ

### 3. File Watcherï¼ˆæ–‡ä»¶ç›‘å¬å™¨ï¼‰
- ä»…ç”¨äºéœ€è¦æ–‡ä»¶ç›‘å¬çš„ AI CLIï¼ˆå¦‚ Claude Codeï¼‰
- ç›‘å¬æ—¥å¿—æ–‡ä»¶å˜åŒ–å¹¶å®æ—¶è§£æ
- ä½¿ç”¨ `watchdog` åº“å®ç°æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ç›‘å¬

### 4. Worker Managerï¼ˆWorker ç®¡ç†å™¨ï¼‰
- åˆ›å»ºã€åˆ é™¤ã€æŸ¥è¯¢ Worker
- ç®¡ç† Worker ä¸é€‚é…å™¨çš„å…³è”
- åè°ƒè¿›ç¨‹ã€æ–‡ä»¶ç›‘å¬å™¨å’Œ WebSocket é€šä¿¡

### 5. è¾“å‡ºæ ‡å‡†åŒ–
- ä¸åŒ AI CLI çš„è¾“å‡ºæ ¼å¼ä¸åŒ
- é€‚é…å™¨è´Ÿè´£å°†åŸå§‹æ ¼å¼è½¬æ¢ä¸ºç»Ÿä¸€çš„æ ‡å‡†æ ¼å¼
- å‰ç«¯å’Œ WebSocket ä½¿ç”¨ç»Ÿä¸€çš„æ•°æ®æ ¼å¼

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### Python å®ç°å¼€å‘

#### è¿è¡Œæµ‹è¯•
```bash
cd pyworker
pytest tests/ -v
```

#### ä»£ç æ ¼å¼åŒ–
```bash
# ä½¿ç”¨ black æ ¼å¼åŒ–
black app/

# ä½¿ç”¨ isort æ’åºå¯¼å…¥
isort app/
```

#### ç±»å‹æ£€æŸ¥
```bash
mypy app/
```

#### ä»£ç æ£€æŸ¥
```bash
# ä½¿ç”¨ ruff
ruff check app/

# ä½¿ç”¨ pylint
pylint app/
```

#### è°ƒè¯•æ¨¡å¼
åœ¨ `.env` ä¸­è®¾ç½® `DEBUG=true`ï¼Œç„¶åï¼š
```bash
uvicorn app.main:app --reload --log-level debug
```

#### æ—¥å¿—æŸ¥çœ‹
```bash
tail -f logs/app.log
```

---

### JavaScript å®ç°å¼€å‘

#### è¿è¡Œæµ‹è¯•
```bash
cd js-worker
npm test

# æˆ–è¿è¡Œç‰¹å®šæµ‹è¯•
npm test -- workerManager.test.ts
```

#### ä»£ç æ ¼å¼åŒ–
```bash
# ä½¿ç”¨ prettier
npm run format

# æ£€æŸ¥æ ¼å¼
npm run format:check
```

#### ç±»å‹æ£€æŸ¥
```bash
npm run type-check
```

#### ä»£ç æ£€æŸ¥
```bash
# ä½¿ç”¨ eslint
npm run lint

# è‡ªåŠ¨ä¿®å¤
npm run lint:fix
```

#### è°ƒè¯•æ¨¡å¼
åœ¨ `.env` ä¸­è®¾ç½® `NODE_ENV=development`ï¼Œç„¶åï¼š
```bash
npm run dev
```

#### æ—¥å¿—æŸ¥çœ‹
```bash
tail -f logs/app.log
```

---

### é€šç”¨å¼€å‘å»ºè®®

1. **åˆ†æ”¯ç®¡ç†**
   - `main` - ç¨³å®šç‰ˆæœ¬
   - `develop` - å¼€å‘åˆ†æ”¯
   - `feature/*` - åŠŸèƒ½åˆ†æ”¯
   - `fix/*` - ä¿®å¤åˆ†æ”¯

2. **æäº¤è§„èŒƒ**
   éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/)ï¼š
   - `feat:` - æ–°åŠŸèƒ½
   - `fix:` - Bug ä¿®å¤
   - `docs:` - æ–‡æ¡£æ›´æ–°
   - `refactor:` - ä»£ç é‡æ„
   - `test:` - æµ‹è¯•ç›¸å…³
   - `chore:` - æ„å»º/å·¥å…·ç›¸å…³

3. **ä»£ç å®¡æŸ¥**
   - æ‰€æœ‰ PR éœ€è¦è‡³å°‘ä¸€ä¸ªå®¡æŸ¥è€…æ‰¹å‡†
   - ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
   - éµå¾ªé¡¹ç›®ä»£ç é£æ ¼

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### è¿›ç¨‹é€šä¿¡æœºåˆ¶

ä¸åŒçš„ AI CLI é€šè¿‡é€‚é…å™¨ç»Ÿä¸€ç®¡ç†ï¼š
- é€šè¿‡ stdin/stdout è¿›è¡Œæ ‡å‡†è¾“å…¥è¾“å‡ºäº¤äº’
- æ ¹æ® AI CLI ç‰¹æ€§é€‰æ‹©è¾“å‡ºè·å–æ–¹å¼ï¼ˆæ–‡ä»¶ç›‘å¬ or stdout è¯»å–ï¼‰
- å¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒå¤š Worker å¹¶å‘è¿è¡Œ

### è¾“å‡ºæ–¹å¼å¯¹æ¯”

| æ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| **æ–‡ä»¶ç›‘å¬** | AI CLI è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ | å¯é ã€æ”¯æŒå†å²æŸ¥è¯¢ | éœ€è¦æ–‡ä»¶ I/Oï¼Œæœ‰è½»å¾®å»¶è¿Ÿ |
| **stdout è¯»å–** | AI CLI ç›´æ¥è¾“å‡ºåˆ° stdout | å®æ—¶æ€§å¥½ã€æ— æ–‡ä»¶ä¾èµ– | æ— æ³•æŸ¥è¯¢å†å²è¾“å‡º |

### æ—¥å¿—æ ¼å¼æ ‡å‡†åŒ–

ç³»ç»Ÿå®šä¹‰äº†ç»Ÿä¸€çš„æ ‡å‡†è¾“å‡ºæ ¼å¼ï¼Œé€‚é…å™¨è´Ÿè´£å°†å„ AI CLI çš„åŸå§‹æ ¼å¼è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ï¼š
- æ ‡å‡†åŒ–çš„æ—¶é—´æˆ³æ ¼å¼
- ç»Ÿä¸€çš„æ¶ˆæ¯ç±»å‹å’Œè§’è‰²å®šä¹‰
- åŒ…å«å…ƒæ•°æ®ï¼ˆAI CLI ç±»å‹ã€æ¨¡å‹ä¿¡æ¯ç­‰ï¼‰

è¿™æ ·å‰ç«¯å’Œ WebSocket é€šä¿¡å±‚æ— éœ€å…³å¿ƒåº•å±‚ AI CLI çš„å·®å¼‚ã€‚

### å®æ—¶æ¨é€æœºåˆ¶

- ä½¿ç”¨ WebSocket å®ç°åŒå‘å®æ—¶é€šä¿¡
- å¯¹äºæ–‡ä»¶ç›‘å¬æ–¹å¼ï¼Œä½¿ç”¨ `watchdog` åº“ç›‘å¬æ–‡ä»¶å˜åŒ–
- å¯¹äº stdout æ–¹å¼ï¼Œç›´æ¥é€šè¿‡å¼‚æ­¥æµå¼è¯»å–
- æ‰€æœ‰è¾“å‡ºé€šè¿‡ WebSocket å®æ—¶æ¨é€åˆ°å‰ç«¯

## â“ å¸¸è§é—®é¢˜

### Q: Worker åˆ›å»ºå¤±è´¥ï¼Ÿ
**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- æŒ‡å®šçš„ AI CLI æ˜¯å¦å·²æ­£ç¡®å®‰è£…ï¼ˆå¦‚ Claude Codeã€OpenCodeï¼‰
- ç›¸åº”çš„ API Key æ˜¯å¦åœ¨ `.env` æ–‡ä»¶ä¸­æ­£ç¡®é…ç½®
- AI CLI ç±»å‹æ˜¯å¦åœ¨ `ENABLED_AI_CLIS` ä¸­å¯ç”¨
- æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### Q: æ— æ³•æ¥æ”¶å®æ—¶è¾“å‡ºï¼Ÿ
**A:** ç¡®ä¿ï¼š
- æ—¥å¿—æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼ˆç”±é€‚é…å™¨çš„ `get_log_file_path()` è¿”å›ï¼‰
- æ–‡ä»¶ç›‘å¬æœåŠ¡æ­£å¸¸è¿è¡Œ
- AI CLI è¿›ç¨‹æ­£åœ¨å†™å…¥æ—¥å¿—æ–‡ä»¶
- æ£€æŸ¥é€‚é…å™¨çš„ `parse_output()` æ–¹æ³•æ˜¯å¦æ­£ç¡®è§£ææ—¥å¿—æ ¼å¼

### Q: WebSocket è¿æ¥æ–­å¼€ï¼Ÿ
**A:** æ£€æŸ¥ï¼š
- é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿ WebSocket ç«¯å£æœªè¢«é˜»æ­¢
- æœåŠ¡å™¨æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
- æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
- ç½‘ç»œè¿æ¥æ˜¯å¦ç¨³å®š

### Q: å¤šä¸ª Worker å¦‚ä½•éš”ç¦»ï¼Ÿ
**A:** æ¯ä¸ª Workerï¼š
- è¿è¡Œåœ¨ç‹¬ç«‹çš„ç›®å½•ä¸­
- ä½¿ç”¨ç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶
- æœ‰ç‹¬ç«‹çš„è¿›ç¨‹ ID
- å¯ä»¥ä½¿ç”¨ä¸åŒçš„ AI CLI ç±»å‹

### Q: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰ AI CLI æ”¯æŒï¼Ÿ
**A:** æŒ‰ä»¥ä¸‹æ­¥éª¤ï¼š
1. åˆ›å»ºæ–°çš„é€‚é…å™¨ç±»ï¼Œç»§æ‰¿ `BaseWorkerAdapter`
2. å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•
3. åœ¨ `adapters/registry.py` ä¸­æ³¨å†Œé€‚é…å™¨
4. åœ¨ `.env` ä¸­æ·»åŠ ç›¸åº”çš„é…ç½®
5. é‡å¯æœåŠ¡

ç¤ºä¾‹ä»£ç è§ [å¦‚ä½•æ·»åŠ æ–°çš„ AI CLI æ”¯æŒ](#å¦‚ä½•æ·»åŠ æ–°çš„-ai-cli-æ”¯æŒ)

### Q: ä¸åŒ AI CLI çš„æ€§èƒ½å·®å¼‚ï¼Ÿ
**A:** æ€§èƒ½å–å†³äºï¼š
- AI CLI æœ¬èº«çš„å“åº”é€Ÿåº¦
- ç½‘ç»œå»¶è¿Ÿ
- åº•å±‚æ¨¡å‹çš„èƒ½åŠ›
- é¡¹ç›®è§„æ¨¡å’Œå¤æ‚åº¦

å»ºè®®æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„ AI CLIã€‚

## æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨å¼‚æ­¥ I/O å¤„ç†å¤šä¸ª Worker
- JSONL æ–‡ä»¶å¢é‡è¯»å–ï¼Œé¿å…é‡å¤è§£æ
- WebSocket è¿æ¥æ± ç®¡ç†
- å®šæœŸæ¸…ç†å·²åœæ­¢çš„ Worker èµ„æº

## å®‰å…¨å»ºè®®

- é™åˆ¶ Worker æ•°é‡ä¸Šé™
- éªŒè¯é¡¹ç›®è·¯å¾„ï¼Œé˜²æ­¢è·¯å¾„éå†æ”»å‡»
- ä¸ºæ¯ä¸ª Worker è®¾ç½®èµ„æºé™åˆ¶
- æ·»åŠ è®¤è¯æœºåˆ¶ä¿æŠ¤ API
- ä½¿ç”¨ HTTPS å’Œ WSS åŠ å¯†é€šä¿¡

## ğŸš€ æœªæ¥è§„åˆ’

### æ ¸å¿ƒåŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ æ›´å¤š AI CLI é€‚é…å™¨ï¼ˆCursorã€Aider ç­‰ï¼‰
- [ ] æ”¯æŒ Worker æŒä¹…åŒ–å’Œæ¢å¤
- [ ] å®ç° Worker æ¨¡æ¿å’Œé¢„è®¾é…ç½®
- [ ] æ·»åŠ å‘½ä»¤å†å²å’Œæœç´¢åŠŸèƒ½
- [ ] æ”¯æŒæ‰¹é‡ Worker æ“ä½œ
- [ ] å®ç°æ™ºèƒ½è·¯ç”±ï¼ˆæ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ä½³ AI CLIï¼‰

### ç›‘æ§ä¸ç®¡ç†
- [ ] å®ç° Worker èµ„æºç›‘æ§ï¼ˆCPUã€å†…å­˜ã€Token ä½¿ç”¨é‡ï¼‰
- [ ] æ·»åŠ å®æ—¶æ€§èƒ½æŒ‡æ ‡ä»ªè¡¨æ¿
- [ ] æ”¯æŒæ—¥å¿—å¯¼å‡ºå’Œåˆ†æ
- [ ] æ·»åŠ  Webhook é€šçŸ¥åŠŸèƒ½

### å¤šç”¨æˆ·ä¸åä½œ
- [ ] æ·»åŠ ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†
- [ ] æ”¯æŒå¤šç”¨æˆ·åä½œ
- [ ] å®ç°å›¢é˜Ÿ Worker å…±äº«
- [ ] æ·»åŠ å®¡è®¡æ—¥å¿—

### æ‰©å±•æ€§
- [ ] æ”¯æŒæ’ä»¶å¸‚åœºï¼ˆè‡ªå®šä¹‰é€‚é…å™¨å‘å¸ƒå’Œå®‰è£…ï¼‰
- [ ] æä¾› gRPC/REST SDK
- [ ] æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
- [ ] æ·»åŠ  Docker/K8s éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯æŠ¥å‘Š Bugã€æå‡ºæ–°åŠŸèƒ½å»ºè®®ï¼Œè¿˜æ˜¯æäº¤ä»£ç æ”¹è¿›ã€‚

### å¦‚ä½•è´¡çŒ®

1. **Fork æœ¬é¡¹ç›®**
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯**
   ```bash
   git checkout -b feature/AmazingFeature
   ```
3. **æäº¤æ›´æ”¹**
   ```bash
   git commit -m 'Add some AmazingFeature'
   ```
4. **æ¨é€åˆ°åˆ†æ”¯**
   ```bash
   git push origin feature/AmazingFeature
   ```
5. **å¼€å¯ Pull Request**

### ä»£ç è§„èŒƒ

- éµå¾ª [PEP 8](https://pep8.org/) ä»£ç é£æ ¼
- ä½¿ç”¨ `black` æ ¼å¼åŒ–ä»£ç 
- æ·»åŠ å¿…è¦çš„ç±»å‹æ³¨è§£
- ç¼–å†™æ¸…æ™°çš„æäº¤ä¿¡æ¯
- ä¸ºæ–°åŠŸèƒ½æ·»åŠ æµ‹è¯•ç”¨ä¾‹

### æŠ¥å‘Šé—®é¢˜

å‘ç° Bugï¼Ÿè¯·é€šè¿‡ [Issues](../../issues) æŠ¥å‘Šï¼Œå¹¶åŒ…å«ï¼š
- é—®é¢˜æè¿°
- å¤ç°æ­¥éª¤
- é¢„æœŸè¡Œä¸º
- å®é™…è¡Œä¸º
- ç¯å¢ƒä¿¡æ¯ï¼ˆPython ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿç­‰ï¼‰

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache License 2.0 è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

```
Copyright 2024 Claude Code Worker Contributors

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
```

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®å’Œç¤¾åŒºï¼š

### AI Code CLI å·¥å…·
- [Claude Code](https://github.com/anthropics/claude-code) - Anthropic å®˜æ–¹ AI å‘½ä»¤è¡Œå·¥å…·
- [OpenCode](https://github.com/opencode/opencode) - å¼€æº AI ç¼–ç¨‹å·¥å…·
- [Aider](https://github.com/paul-gauthier/aider) - AI pair programming in terminal
- [Cursor](https://cursor.sh/) - AI-first ä»£ç ç¼–è¾‘å™¨

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- [FastAPI](https://fastapi.tiangolo.com/) - é«˜æ€§èƒ½çš„ Python Web æ¡†æ¶
- [Watchdog](https://github.com/gorakhargosh/watchdog) - Python æ–‡ä»¶ç³»ç»Ÿç›‘æ§åº“
- [Pydantic](https://pydantic-docs.helpmanual.io/) - æ•°æ®éªŒè¯å’Œè®¾ç½®ç®¡ç†
- [uvicorn](https://www.uvicorn.org/) - ASGI æœåŠ¡å™¨

### ç¤¾åŒºè´¡çŒ®è€…
æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ª â­ï¸**

[![Star History Chart](https://api.star-history.com/svg?repos=your-repo/ai-code-worker-manager&type=Date)](https://star-history.com/#your-repo/ai-code-worker-manager&Date)

Made with â¤ï¸ by the AI Code Worker Manager team

[æ–‡æ¡£](./docs) â€¢ [ç¤ºä¾‹](./examples) â€¢ [è®¨è®º](../../discussions) â€¢ [æ›´æ–°æ—¥å¿—](./CHANGELOG.md)

</div>

